# 🏪 java-convenience-store-precourse

----
## 📌 프로젝트 개요
- 이 프로젝트는 Java로 구현된 간단한 편의점 관리 시스템입니다. 상품 재고 관리, 프로모션 할인, 멤버십 할인, 영수증 출력을 포함하여 고객의 편리한 쇼핑을 지원합니다.
---
## ⚙️ 주요 기능

### 📦 재고 관리
- **재고 수량 확인**: 재고를 확인해 결제 가능 여부를 판단합니다.
- **재고 차감**: 결제 후에는 해당 수량만큼 재고가 차감됩니다.
- **프로모션 재고 우선 차감**: 프로모션 중인 상품은 프로모션 재고를 우선 차감하며, 부족하면 일반 재고를 사용합니다.

### 💸 할인 
#### 1. 프로모션 할인
- **프로모션 기간 내 할인**: 프로모션 기간에만 할인이 적용됩니다.
- **N+M 혜택**: N개 구매시 M개 무료 증정 혜택을 제공합니다
- **재고 한정**: 프로모션 혜택은 재고 내에서만 적용됩니다.
- **혜택 안내**: 고객이 프로모션 혜택을 놓치지 않도록 추가 수량 안내를 제공합니다
- **정가 결제 안내**: 프로모션 재고가 부족해 일부 정가 결제 시 안내 메시지를 제공합니다.

#### 2. 멤버십 할인
- **할인 여부 입력**: 고객에 멤버십 할인을 선택할 수 있습니다.
- **30% 할인**: 멤버십 회원은 프로모션 적용 후 남은 금액에 대해 멤버십 할인을 적용합니다.
- **최대 한도 8,000원**: 멤버십 할인의 최대 한도는 8,000원입니다.

### 🛒 주문
- 사용자는 아이템 주문 수량을 입력하여 주문할 수 있습니다.

### 영수증 출력
- **구매 내역 요약**: 고객의 구매 내역과 할인 정보를 영수증으로 제공합니다.
- **영수증 항목**
  - 구매 상품 내역
  - 증정 상품 내역
  - 금액 정보
    - 총 구매액
    - 행사 할인
    - 멤버십 할인
    - 최종 금액

---
## 🚨 예외 상황 및 유효성 검사
| 예외 상황                        | 설명                                                            |
|----------------------------------|-----------------------------------------------------------------|
| 유효하지 않은 날짜 입력          | 유효하지 않은 날짜가 입력되면 에러를 반환합니다.               |
| 프로모션 종료 날짜 오류          | 종료 날짜가 시작 날짜보다 빠른 경우 에러를 반환합니다.         |
| 재고 초과 주문                   | 주문 수량이 재고를 초과하면 에러를 반환합니다.                 |
| 잘못된 값 입력                   | 사용자가 잘못된 값을 입력할 경우 에러를 반환합니다.           |
| 잘못된 주문 형식 입력            | 주문 입력 형식이 올바르지 않으면 에러를 반환합니다.           |
| 없는 상품 주문                   | 주문하는 상품이 존재하지 않으면 에러를 반환합니다.           |


---
### 📝 기능 목록
- [x] ```promotions.md``` 파일을 읽어 프로모션 정보 저장
- [x] 주문 수량과 남은 재고 중에서 가능한 무료 증정 아이템의 개수를 알려준다
- [x] ```products.md``` 파일을 읽어들여서 저장한다
- [x] ```products.md``` 파일 중에 프로모션이 있는 아이템만 있는 경우 프로모션 없는 아이템도 생성시킨다
- [x] 재고를 예쁘게 출력되도록 꾸민다
- [x] 주문을 하면 재고가 감소된다
- [x] 프로모션 중인 상품을 주문할 때 재고를 초과하여 주문하면 초과분을 알려준다
- [x] 프로모션 재고만 주문 가능 여부를 설정할 수 있다
- [x] 프로모션 주문 조건 만족 시 무료 증정 아이템 수량을 안내한다
- [x] 프로모션 주문 조건에 만족하여 받고 싶다면 무료 증정 아이템을 받을 수 있다 
- [x] 프로모션 적용 여부를 알려준다
- [x] 프로모션 진행 중인 상품을 주문하면 프로모션 재고가 먼저 차감되고 재고가 부족하면 일반 재고가 차감된다
- [x] 멤버십 할인을 받는다면 프로모션 금액이 차감된 금액의 0.3%를 받을 수 있다
  - 최대금액은 8,000원이다
- [x] 영수증을 출력한다 (멤버십 할인 및 무료 증정 상품 포함)
- [x] 주문한 내역들을 예쁘게 출력되도록 꾸민다

--- 
## 📝 고민한 점
- **아키텍처**
  - 아키텍처는 항상 어렵지만, 이번에 아키텍처가 왜 중요한지 뼈저리게 느꼈다. 설계가 제대로 되어야 테스트 코드도 자연스럽게 작성되고, 객체지향적으로 짜기에도 훨씬 수월하다는 걸 알았다. 특히 테스트 코드를 작성할 때 이 점이 크게 다가왔는데, 아직 TDD에 익숙하지 않아서 일단 코드를 짠 후 테스트 코드를 작성하다 보니 테스트가 잘 안 되거나 어렵게 느껴지는 경우가 많았다. 그러다 ```테스트 코드 작성이 어려우면 설계가 잘못된 것```이라는 글을 보게 됐다. 그 말에 큰 깨달음을 얻고, 다시 설계부터 차근차근 다듬기 시작했다. 내 나름대로 스프링부트스럽게 객체지향스럽게 만들어 볼 수 있어서 뿌듯했다.
- **Controller**
  - 그동안 프리코스를 진행하면서 Controller에 ```private 메서드```가 많아져서 ```Controller에 역할이 많아 보인다```는 피드백을 받았고, 그때부터 역할 분리에 신경을 많이 썼다. 그런데 이번에도 Controller에서 실행하는 메서드가 많아지는 걸 보니 아직 해결이 덜 된 느낌이다. 하지만 나는 Controller가 외부 시스템과 연결하는 API 역할을 하니, 입력과 출력을 담당하는 게 당연하다고 생각한다. Controller에서 Input과 Output을 처리하는 게 자연스럽지 않나 싶다.
- **Repository**
  - ``` Map<String, List<Product>>``` 이런식으로 저장을 하다보니 findAll을 할 때 ```Map<String, List<Product>>``` 이런식으로 됐었다. 너무 가독성 떨어진다고 생각해서 일급 객체로 감싸서 반환할 생각이었다. 그걸 repository에서 할지 service에서 할지 고민이었는데 repository는 있는 그대로 보내주고 service에서 가공을 하면 좋겠다는 생각을 했다. repository에서는 순수 도메인으로 반환하고 service에서 가공을 하는 게 나중에 jpa나 마이바티스로 바꿨을 때도 효율적이라고 생각했다
- **VO**
  - 재고 안에 ```item```을 어떻게 구현할지 고민했었다. ```item```은 입력받는 값이기 때문에, ```enum```으로 관리하면 수정이 불가능해 불편할 것 같아 ```VO(Value Object)```로 처리하려고 생각했다. 하지만 지금은 고정된 아이템과 가격을 받는 방식이기 때문에, enum으로 관리하는 것이 유지보수 측면에서 더 효율적이라는 생각이 들었다.
  - 하지만 프로모션은 VO로 관리했는데, ```"탄산2+1"```, ```"MD추천상품"```과 같은 이름은 그대로 두되, 프로모션의 증정 아이템은 ```"1+1"```이 아닌 ```"2+3"```과 같은 다양한 형태로 변경될 수 있기 때문에 VO를 채택했다. 또한, 다양한 프로모션에 대한 테스트도 가능하다는 점에서 VO가 더 적합하다고 판단했다. 사실, 둘 다 ```enum```으로 관리할 수 있겠지만, 누군가는 ```item```은 VO가 더 맞지 않겠냐고 할 수도 있다. 하지만 프로모션의 변동성이 크다는 점을 고려하면, enum을 사용하라는 명시적인 이유가 없었다면, 나는 둘 다 VO로 관리했을 것이다. 왜냐하면 둘 다 빈번하게 수정될 가능성이 크고, 입력도 자주 이루어질 것이라고 판단했기 때문이다.
  - VO에서 비즈니스로직을 갖도록 고민을 했다. 예를 들어 ```PromotionDetails```에서 총 프로모션 수량을 반환하는 로직을 갖는 걸 생각했다. 하지만 VO는 값 자체를 표현하는 객체 주로 불변성을 유지한다고 생각하고, 도메인에서 비즈니스 로직을 가져야 객체지향스럽다고 생각했다. VO가 단지 값을 더하고 반환하는 로직은 가져도 된다고 생각은 하지만 정답은 모르겠다. 
- **Enum**
  - enum에서 원하는 값을 못찾으면 error을 반환하는 로직을 해도 좋을지 고민했다. 일단 ```null```을 반환하고 ```service단```에서 ```null```일 경우 다른 값을 입력하는 경우를 생각했다. 하지만 enum에서 원하는 값을 못찾으면 에러를 반환하는 것이 좀 더 유지보수 측면에서도 좋고, 예외 상황을 빠르게 파악할 수 있을 것이라고 생각했다.
- **문제**
  1. N을 입력하면 프로모션 혜택을 받는 재고만 결제한다고 생각했다. 컵라면을 예로 들면 혜택을 못받게 된다. 1+1이니까
  - 컵라면은 프로모션 혜택을 받을 수 있는 수량이 0이니까 재고가 없다는 에러를 반환하기로 했다. 테스트코드도 그러기도 했고
```java
프로모션 재고가 부족하여 일부 수량을 프로모션 혜택 없이 결제해야 하는 경우, 일부 수량에 대해 정가로 결제할지 여부를 입력받는다.
Y: 일부 수량에 대해 정가로 결제한다.
N: 정가로 결제해야하는 수량만큼 제외한 후 결제를 진행한다.
- 컵라면 1,700원 1개 MD추천상품,
- 컵라면 1,700원 10개

assertSimpleTest(() -> {
            runException("[컵라면-12]", "N", "N");
            assertThat(output()).contains("[ERROR] 재고 수량을 초과하여 구매할 수 없습니다. 다시 입력해 주세요.");
        })
```
  2. 처음 프로모션 이벤트를 생각했을 때, 2+1은 ```"2개를 사면 1개를 무료로 준다"```는 방식으로 떠올랐다. 하지만 점점 생각할수록, ```"3개를 사면 1개를 무료로 증정하는"``` 이벤트가 더 적합하다는 느낌이 들었다. 그래서 이를 바탕으로 코드를 작성했다.
  3. 재고가 부족하면 재고가 없다는 메시지가 뜨고 ```감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)```가 뜨고 ```Y```를 입력해야 다시 한번 진행되도록 짰다. 만약 특정 아이템만 20개만 사고 싶었는데 없다면 아예 쇼핑을 하지 않는다고 생각을 했다.
  
